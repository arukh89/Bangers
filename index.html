<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>$Bangers | #betonbangers</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{--bg:#111;--card:#1c1c1c;--pink:#ff0055;--radius:12px;}
    *{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;}
    body{background:var(--bg);color:#fff;padding:16px;font-size:14px;}
    .cast{background:var(--card);border-radius:var(--radius);padding:14px;margin-bottom:12px;}
    .user{font-weight:700;}
    .text{font-size:13px;color:#ccc;margin:6px 0;word-break:break-word;}
    .nums{font-size:13px;color:#aaa;}
    button{border:none;padding:8px 14px;border-radius:var(--radius);font-weight:600;cursor:pointer;}
    .like-btn{background:#222;color:#fff;}
    .like-btn.liked{background:var(--pink);}
  </style>
</head>
<body>
<div id="casts">Loading‚Ä¶</div>
<script type="module">
  const API = window.location.origin + '/api';
  async function load(){
    const list = await fetch(`${API}/casts`).then(r => r.json());
    const box = document.getElementById('casts');
    box.innerHTML = '';
    list.forEach(c => {
      const div = document.createElement('div');
      div.className = 'cast';
      div.innerHTML = `
        <div class="user">@${c.username}</div>
        <div class="text">${c.text}</div>
        <div class="nums">‚ù§Ô∏è ${c.likes}  |  üí∞ $BANGERS ${c.farmed}</div>
        <button class="like-btn ${c.userLiked?'liked':''}" data-hash="${c.castHash}">
          üëç LIKE
        </button>`;
      box.appendChild(div);
    });
  }
  addEventListener('click', async e => {
    const btn = e.target.closest('.like-btn');
    if (!btn) return;
    const hash = btn.dataset.hash;
    const res = await fetch(`${API}/like`, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({castHash: hash})
    }).then(r => r.json());
    btn.classList.toggle('liked', res.liked);
    btn.parentElement.querySelector('.nums').textContent =
      `‚ù§Ô∏è ${res.likes}  |  üí∞ $BANGERS ${res.farmed}`;
  });
  load();
</script>
</body>
</html>
